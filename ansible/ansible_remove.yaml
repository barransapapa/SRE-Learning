---
- name: Remove Prometheus Deployment
  hosts: all
  tasks:
    - name: Delete Prometheus Namespace
      k8s:
        state: absent
        kind: Namespace
        name: monitoring
    - name: Ensure Prometheus Deployment is Removed
      k8s:
        state: absent
        kind: Deployment
        namespace: monitoring
        name: prometheus-deployment
        force: true
    - name: Ensure Prometheus Service is Removed
      k8s:
        state: absent
        kind: Service
        namespace: monitoring
        name: prometheus-service
    - name: Ensure Prometheus ConfigMap is Removed
      k8s:
        state: absent
        kind: ConfigMap
        namespace: monitoring
        name: prometheus-config
- name: Remove nasa-app Deployment
  hosts: all
  tasks:
    - name: Delete nasa Namespace
      k8s:
        state: absent
        kind: Namespace
        name: nasa
    - name: Ensure nasa-app Deployment is Removed
      k8s:
        state: absent
        kind: Deployment
        namespace: nasa
        name: nasa-app
    - name: Ensure nasa-app-service is Removed
      k8s:
        state: absent
        kind: Service
        namespace: nasa
        name: nasa-app-service
    - name: Ensure nasa-app ConfigMap is Removed
      k8s:
        state: absent
        kind: secret
        namespace: nasa
        name: nasa-api-key 
- name: Remove OpenTelemetry Collector Deployment
  hosts: all
  tasks:
    - name: Ensure otel-collector Deployment is Removed
      k8s:
        state: absent
        kind: Deployment
        namespace: opentelemetry
        name: otel-collector
    - name: Ensure otel-collector ConfigMap is Removed
      k8s:
        state: absent
        kind: ConfigMap
        namespace: opentelemetry
        name: otel-config
    - name: Remove Jaeger Deployment
      k8s:
        state: absent
        kind: Deployment
        namespace: opentelemetry
        name: jaeger
    - name: Ensure jaeger Services are Removed
      k8s:
        state: absent
        kind: Service
        namespace: opentelemetry
        name: jaeger
    - name: Delete OpenTelemetry Namespace
      k8s:
        state: absent
        kind: Namespace
        name: opentelemetry
    - name: Ensure storage persistent volume 1 and claim are Removed
      k8s:
       state: absent
       kind: PersistentVolume
       name: log-pv-1
    - name: Ensure storage persistent volume 2 and claim are Removed
      k8s:
       state: absent
       kind: PersistentVolume
       name: log-pv-2
- name: Pause for resources to be deleted
  hosts: all
  tasks:
    - name: Wait for 30 seconds
      pause:
        seconds: 30